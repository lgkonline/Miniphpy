function getUrlPar(e){return decodeURI((RegExp(e+"=(.+?)(&|$)").exec(location.search)||[,null])[1])}function encodeUrl(e){return encodeURIComponent(e).replace(/'/g,"%27").replace(/"/g,"%22")}function decodeUrl(e){return decodeURIComponent(e.replace(/\+/g," "))}function getDate(e){var a=new Date(e);if(isNaN(a.getTime()))return e;var t=a.getDate(),n=a.getMonth()+1,i=a.getFullYear(),s=a.getHours(),r=a.getMinutes();9>=t&&(t="0"+t),9>=n&&(n="0"+n),9>=s&&(s="0"+s),9>=r&&(r="0"+r);var o=new Array;return o.GER=t+"."+n+"."+i+", "+s+":"+r,o.ENG=i+"-"+n+"-"+t+", "+s+":"+r,o[getLanguage()]}function initSignOutVisibility(){$.cookie("Auth")?$("#sign-out-services").show():$("#sign-out-services").hide()}function installSearchEngine(){window.external&&"AddSearchProvider"in window.external?window.external.AddSearchProvider("http://localhost:58529/Download/searchconnector.osdx"):alert("No search engine support")}function initThumbnails(){$(".search-page.active .search-thumbnail-img").each(function(){var e=this,a=$(this).data("thumbnail-path");$("<img />").attr("src",a).load(function(){this.complete&&"undefined"!=typeof this.naturalWidth&&1!=this.naturalWidth&&($(e).parent().hasClass("search-thumbnail")||($(e).attr("src",a),$(e).removeClass("thumbnail"),$(e).wrap("<a href='javascript:void(0);' data-img='"+a+"' class='thumbnail search-thumbnail'></a>"),$(e).parent().imgPreview({imgCSS:{height:700},srcAttr:"data-img"})))})})}function noSearchTerm(){0==noSearchTermAlreadyShown&&($("#results").empty(),$("#results").append("<h1>"+getPhrase("Keine Eingabe")+"</h1>"),$("#manga-searchform-input").select()),noSearchTermAlreadyShown=!0}function prepareSingleService(e,a,t,n){("undefined"==typeof n||null==n)&&(n=null),areThereSelectedSources=!0,totalServices++,allServices[a]={sourceName:a,sourceUrl:e,sourceNameUnescaped:t},$("#results-loading").fadeIn(),"undefined"!=typeof search&&null!=search&&""!=search||"undefined"!=typeof n&&null!=n&&""!=n?loadDataFromSingleSource(e,a,$("#search").data("page"),t,n):noSearchTerm()}function loadDataTypes(){$.ajax({url:rootPath+"/json/dataTypes.json",dataType:"json",success:function(e){if(dataTypes=e,$.cookie("filterObj")){var a=JSON.parse($.cookie("filterObj"));"undefined"!=typeof mode&&"default"==mode&&$.removeCookie("filterObj"),$.each(a.sources,function(e,a){prepareSingleService(a.sourceUrl.replace(/&amp;/g,"&"),a.name,a.nameUnescaped,a.searchTerm)})}else $(".select-source").has(".checkbox-input[checked]").each(function(){prepareSingleService($(this).find(".checkbox-input").val(),$(this).find(".checkbox-input").data("source-name"),$(this).find(".checkbox-input").data("source-name-unescaped"))});areThereSelectedSources===!1&&$("#results").prepend("<div class='alert alert-info'><button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button><p>"+getPhrase("Keine Datenquelle gewählt")+"</p></div>")}})}function getDataType(e){var a=e.split("."),t=a[a.length-1].toLowerCase(),n="default";return $.each(dataTypes,function(e,a){a.extensions.indexOf(t)>-1&&(n=a.id)}),n}function getExtensionByFilename(e){var a=e.split("."),t=a[a.length-1].toLowerCase();return t}function make_base_auth(e,a){var t=e+":"+a,n=window.btoa(t);return n}function loadDataFromSingleSource(e,a,t,n,i,s,r,o){("undefined"==typeof i||null==i)&&(i=search),allServices[a].searchTerm=i,("undefined"==typeof s||null==s)&&(s=""),("undefined"==typeof r||null==r)&&(r=""),("undefined"==typeof o||null==o)&&(o=!1),$.ajax({url:rootPath+"/Proxy/?ServiceUri="+encodeURIComponent(e)+"&searchTerm="+i,dataType:"xml",data:{remember:o},beforeSend:function(e){""!=s&&""!=r&&e.setRequestHeader("Authorization",make_base_auth(s,r)),$("#select-source-"+a+" .checkbox-input").after("<img class='small-loader' src='"+rootPath+"/images/small-loading.GIF' alt='Loading'>")},success:function(e){var i=$.xml2json(e);if(!isNaN(i.channel.totalResults)&&(totalResults+=1*i.channel.totalResults,1*i.channel.totalResults>0))for(var s=0;s<i.channel.item.length;s++)i.channel.item[s].sourceName=a,i.channel.item[s].sourceNameUnescaped=n,i.channel.item[s].position=s+1,resultObjs.push(i.channel.item[s]);$("#select-source-"+a).find(".small-loader").fadeOut(),totalServicesLoaded++,totalServices===totalServicesLoaded&&($("#results-loading").remove(),loadData(resultObjs,t)),initSignOutVisibility()},error:function(i){if(console.log(i),401==i.status){var s=!1;$("#auth-modal").modal("show"),$("#auth-modal-sourceName").text(a),s&&$("#auth-modal-alert").removeClass("hidden"),$("#auth-modal-form").submit(function(){$("#auth-modal").modal("hide");var i=$("#auth-modal-username").val(),r=$("#auth-modal-password").val(),o=$("#auth-modal-remember").is(":checked");return loadDataFromSingleSource(e,a,t,n,null,i,r,o),s=!0,!1})}else $("#results").prepend("<div class='alert alert-danger'><button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button><p>We couldn't load "+a+" (<a href='"+e+"' target='_blank'>"+e+"</a>)</p></div>")}})}function loadData(e,a){e.length<=0&&$("#results").prepend("<div class='alert alert-info'><button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button><p>"+getPhrase("Die Suche ergab keine Treffer.")+"</p></div>");var t="result-pane";$("#"+t).blAppear(),"DateDESC"==orderBy?e.sort(function(e,a){return new Date(a.pubDate)-new Date(e.pubDate)}):"DateASC"==orderBy?e.sort(function(e,a){return new Date(e.pubDate)-new Date(a.pubDate)}):e.sort(function(e,a){return e.position-a.position});var n,i=totalResults,s=e;"undefined"==typeof s&&(s=results),0==s.totalResults?(n=0,$("#"+t).append("<div class='alert alert-info'><p><span class='glyphicon bi-information'></span> "+getPhrase("Die Suche ergab keine Treffer.")+"</p></div>"),$("#"+t).find(".loader").hide()):n=s.length;var r;r=0==i?0:s.chunk(resultsPerPage),i>n?$("#manga-results-count").text(getPhrase("ErgebnisseCapitalize")+" "+n+" "+getPhrase("von")+" "+i):$("#manga-results-count").text(n+" "+getPhrase("Ergebnisse"));for(var o="",l="",c=0;c<r.length;c++){var u=c+1,d=t+"-page-"+u;1==u?o=d:u==r.length&&(l=d),$("#search-ghost-pagination").append("<li data-page='"+u+"'><a href='#"+d+"' aria-controls='"+d+"' data-toggle='tab'>"+u+"</a></li>");var h=r[c];"[object Object]"===Object.prototype.toString.call(h)&&(h=r[c]),$("#"+t+" .results-count").after("<div id='"+d+"' class='tab-pane search-page'></div>");var p=0;$.each(h,function(e,a){p++;var t=getDataType(a.title);getExtensionByFilename(a.title);if("undefined"!=typeof a.title){var n="";""!==a.author&&"undefined"!==a.author&&"undefined"!=typeof a.author&&(n=getPhrase("Von")+": "+a.author),$("#"+d).append("<div class='media' id='result-"+p+"'><div class='media-body clearfix'><div class='row'><div class='col-xs-3 search-thumbnail-col'><img id='"+d+"-thumbnail-"+e+"' class='search-thumbnail-img thumbnail' data-thumbnail-path='"+rootPath+"/ImageViewer.aspx?path="+encodeUrl(a.link)+"&fileName="+a.title+"' src='"+rootPath+"/images/dataTypes/"+t+"/128px.png' alt='Preview'></div><div class='col-xs-9'><h4 class='media-heading'><a class=\"result-link\" href=\""+a.link+'">'+a.title+"</a></h4><p>"+a.description+"</p><p class='text-muted'>"+getPhrase("Veröffentlicht")+": "+getDate(a.pubDate)+"<br>"+getPhrase("Quelle")+": "+a.sourceName+"<br>"+n+"</p></div></div></div></div>")}})}if($("a[href='#"+o+"']").tab("show"),$("#results .media").highlight(search),r.length<=1)$("#"+t).find(".pagination-area").hide();else{var g=1;if(window.location.hash){var m=1*window.location.hash.replace("#","");m>=1&&m<=r.length&&(g=m)}$("#search-pagination").twbsPagination({totalPages:r.length,visiblePages:5,onPageClick:function(e,a){window.location.hash=a,$("#search-ghost-pagination").find("li[data-page='"+a+"']").find("a").tab("show")},startPage:g,first:"<span class='glyphicon bi-navigate_left2'></span>",prev:"<span class='glyphicon bi-navigate_left'></span>",last:"<span class='glyphicon bi-navigate_right2'></span>",next:"<span class='glyphicon bi-navigate_right'></span>"})}initThumbnails(),initTabBlAppear(),$.event.trigger({type:"resultsBuilt",message:"Search results of all sources are ready",time:new Date,results:e,services:allServices,appName:$("html").attr("data-appname")})}function initTabBlAppear(){$("a[data-toggle='tab']").on("shown.bs.tab",function(e){initThumbnails()})}var appPath=$("html").data("application-path"),besenUrl=$("html").data("besen-url"),rootPath=$("html").data("root-path");Array.prototype.chunk=function(e){var a=this;return[].concat.apply([],a.map(function(t,n){return n%e?[]:[a.slice(n,n+e)]}))},$.ajax({url:appPath+"/json/fillers.json",dataType:"json",success:function(e){var a="Operatoren",t=e.Operatoren,n="manga-search-fillers-list-"+a;$("#manga-search-fillers tbody").append("<tr><th class='lang'>"+a+"</th><td><ul id='"+n+"' class='nav nav-pills'></ul></td></tr>"),$.each(t,function(e,a){$("#"+n).append("<li><a href='javascript:void(0);' title='"+a.tooltip+"' onclick=\"appendToSearchInput('"+a.value+"');\" class='lang'>"+a.name+"</a></li>")}),initLangDom()},error:function(){console.log("Something went wrong")}}),appendToSearchInput=function(e){$("#manga-searchform-input").each(function(){$(this).val($(this).val()+" "+e+" "),$(this).focus()})},initBtTooltip=function(){$(".bt-tooltip").tooltip(),$(".bt-tooltip-top").tooltip({placement:"top"}),$(".bt-tooltip-bottom").tooltip({placement:"bottom"}),$(".bt-tooltip-left").tooltip({placement:"left"}),$(".bt-tooltip-right").tooltip({placement:"right"}),$(".bt-tooltip-lang").each(function(){var e=$(this).attr("data-title"),a=getPhrase(e);$(this).tooltip({title:a})})},$(document).ready(function(){initBtTooltip(),$("#toggle-manga-search-fillers").click(function(){$(this).find("span.glyphicon").toggleClass("hide"),$("#manga-search-fillers").removeClass("hide"),$("#manga-search-fillers").slideToggle(),$("#header").toggleClass("blScrollingHead")}),initSignOutVisibility(),$("#sign-out-services").click(function(){$.removeCookie("Auth"),location.reload()})});var resultsPerPage=$("#search").data("results-per-page"),search=$("#search").data("search"),orderBy,noSearchTermAlreadyShown=!1,dataTypes,totalServices=0,totalServicesLoaded=0,allServices={},areThereSelectedSources=!1,resultObjs=[],totalResults=0;$(document).ready(function(){loadDataTypes(),initTabBlAppear(),$("#toggle-manga-results-row-sidebar").click(function(){$(this).toggleClass("active"),$("#manga-results-row-sidebar").toggleClass("hidden-sm hidden-xs")}),$("#results-tabs a:first").tab("show")}),$(".select-source").each(function(){var e=$(this).data("data-source");$(this).find(".checkbox-input").change(function(){$(this).is(":checked")?$("#input-"+e).remove():$("#form-data-sources").append("<input type='hidden' name='uncheck' id ='input-"+e+"' value='"+e+"'>")})}),$(".select-order").each(function(){$(this).find(".radio-input").is(":checked")&&(orderBy=$(this).find(".radio-input").val())});